# LAMMPS to Numpy Conversion and DeepMD Workflow

## Overview

When use Python3 interface for predicting the energy & force for large system, OOM can happen easily. LAMMPS implementation of DP can use multiple GPU cards, avoiding the OOM. 
These scripts are used for: `1. convert DeepMD format database to lammps data files` + `2. use LAMMPS to evaulate the energy and force` + `3. convert the output into DeepMD format`

## File Descriptions

### 1. `dp2lmp.py`
- **Role**: Converts DeepMD `.npy` format data into LAMMPS configuration files.
- **Details**:
  - Reads a DeepMD dataset from the specified directory.
  - Converts each frame into a LAMMPS-compatible configuration file (`.conf`).
  - Outputs the configuration files into the specified directory.

### 2. `input.lammps`
- **Role**: LAMMPS input script for running simulations.
- **Details**:
  - Loops over multiple LAMMPS configuration files (`.conf`) generated by `dp2lmp.py`.
  - Computes potential energy for each configuration using a DeepMD model.
  - Outputs:
    - `pe.dat`: Contains potential energy values for each frame.
    - `pe.lammpstrj`: Contains atomic positions and forces for each frame.

### 3. `lmp2npy.py`
- **Role**: Extracts simulation results from LAMMPS output files and saves them as Numpy arrays.
- **Details**:
  - Reads potential energy values from `pe.dat` and saves them as `energy.npy`.
  - Reads atomic forces from `pe.lammpstrj` and saves them as `forces.npy`.

## How to Use

### Step 1: Convert DeepMD Data to LAMMPS Configuration Files
1. Ensure the DeepMD dataset is available in the specified directory (e.g., `8/sc8/Pb512Ti512O1536`).
2. Run the `dp2lmp.py` script:
   ```bash
   python dp2lmp.py
   ```
3. The script will generate LAMMPS configuration files in the `8/conf/` directory.

### Step 2: Run LAMMPS Simulations
1. Ensure LAMMPS is installed and accessible from the command line.
2. Place the `input.lammps` file in the working directory.
3. Run the LAMMPS simulation:
   ```bash
   lmp -in input.lammps
   ```
4. The simulation will generate:
   - `pe.dat`: Contains potential energy values.
   - `pe.lammpstrj`: Contains atomic positions and forces.

### Step 3: Convert LAMMPS Output to Numpy Arrays
1. Run the `lmp2npy.py` script:
   ```bash
   python lmp2npy.py
   ```
2. The script will generate:
   - `energy.npy`: Numpy array of potential energy values.
   - `forces.npy`: Numpy array of atomic forces.

## Notes
- Dependency: `dpdata` + `numpy`